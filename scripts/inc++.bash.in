#!/bin/bash
# Copyright (C) 2019-2023 Lawrence Livermore National Security, LLC., Xavier Andrade, Alfredo A. Correa
#
# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at https://mozilla.org/MPL/2.0/.
                             
if [[ "$*" == *-c* ]]
then
    #we are just compiling
    cxx="@INCPP_COMPILER@"
    ldflags=""
    libs=""
else
    #we are linking too
    cxx="@INCPP_COMPILER@"
    ldflags="@CMAKE_EXE_LINKER_FLAGS@ "
    libs="@spglib_LIBRARIES@ @Libxc_LIBRARIES@ @LAPACK_LIBRARIES@ @BLAS_LIBRARIES@ @NCCL_LIBRARIES@ @INQ_CUDA_LIBRARIES@ -L@Boost_LIBRARY_DIRS@ -lboost_serialization -lboost_filesystem -lboost_system  @FFTW_LDFLAGS@ @CMAKE_CXX_STANDARD_LIBRARIES@ @MPI_CXX_LIBRARIES@"
fi		

includeflags="-I@spglib_INCLUDE_DIRS@            \
  -I@Libxc_INCLUDE_DIRS@                         \
  -I@multi_INCLUDE_DIRS@                         \
  -I@mpi3_INCLUDE_DIRS@                          \
  -I@Boost_INCLUDE_DIRS@                         \
  -I@@NCCL_INCLUDE_DIRS@                         \
  @FFTW_CFLAGS@                          \
  -I@PROJECT_BINARY_DIR@/                        \
  -I@PROJECT_BINARY_DIR@/external_libs/pseudopod \
  -I@PROJECT_SOURCE_DIR@/src/                    \
  -I@PROJECT_SOURCE_DIR@/external_libs/          \
  -I@MPI_CXX_INCLUDE_DIRS@"

command_line="$cxx -std=c++17 @INCPP_FLAGS@ ${includeflags//;/ -I} $ldflags $* ${libs//;/ }"

echo $command_line && $command_line
